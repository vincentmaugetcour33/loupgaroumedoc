(function(a){a.fn.bPopup=function(K,P){function I(){af.modal&&a('<div class="b-modal '+ac+'"></div>').css({backgroundColor:af.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:af.zIndex+X}).appendTo(af.appendTo).fadeTo(af.speed,af.opacity);b();ae.data("bPopup",af).data("id",ac).css({left:"slideIn"===af.transition?-1*(W+aa):V(!(!af.follow[0]&&T||ab)),position:af.positionStyle||"absolute",top:"slideDown"===af.transition?-1*(R+aa):Q(!(!af.follow[1]&&N||ab)),"z-index":af.zIndex+X+1}).each(function(){af.appending&&a(this).appendTo(af.appendTo)});O(!0)}function M(){af.modal&&a(".b-modal."+ae.data("id")).fadeTo(af.speed,0,function(){a(this).remove()});af.scrollBar||a("html").css("overflow","auto");a(".b-modal."+ac).unbind("click");Z.unbind("keydown."+ac);ad.unbind("."+ac).data("bPopup",0<ad.data("bPopup")-1?ad.data("bPopup")-1:null);ae.undelegate(".bClose, ."+af.closeClass,"click."+ac,M).data("bPopup",null);O();return !1}function L(g){var c=g.width(),h=g.height(),j={};af.contentContainer.css({height:h,width:c});h>=ae.height()&&(j.height=ae.height());c>=ae.width()&&(j.width=ae.width());o=ae.outerHeight(!0);aa=ae.outerWidth(!0);b();af.contentContainer.css({height:"auto",width:"auto"});j.left=V(!(!af.follow[0]&&T||ab));j.top=Q(!(!af.follow[1]&&N||ab));ae.animate(j,250,function(){g.show();i=U()})}function O(c){switch(af.transition){case"slideIn":ae.css({display:"block",opacity:1}).animate({left:c?V(!(!af.follow[0]&&T||ab)):Z.scrollLeft()-(aa||ae.outerWidth(!0))-200},af.speed,af.easing,function(){S(c)});break;case"slideDown":ae.css({display:"block",opacity:1}).animate({top:c?Q(!(!af.follow[1]&&N||ab)):Z.scrollTop()-(o||ae.outerHeight(!0))-200},af.speed,af.easing,function(){S(c)});break;default:ae.stop().fadeTo(af.speed,c?1:0,function(){S(c)})}}function S(c){c?(ad.data("bPopup",X),ae.delegate(".bClose, ."+af.closeClass,"click."+ac,M),af.modalClose&&a(".b-modal."+ac).css("cursor","pointer").bind("click",M),!H&&(af.follow[0]||af.follow[1])&&ad.bind("scroll."+ac,function(){i&&ae.dequeue().animate({left:af.follow[0]?V(!ab):"auto",top:af.follow[1]?Q(!ab):"auto"},af.followSpeed,af.followEasing)}).bind("resize."+ac,function(){if(i=U()){clearTimeout(J),J=setTimeout(function(){b();ae.dequeue().each(function(){ab?a(this).css({left:W,top:R}):a(this).animate({left:af.follow[0]?V(!0):"auto",top:af.follow[1]?Q(!0):"auto"},af.followSpeed,af.followEasing)})},50)}}),af.escClose&&Z.bind("keydown."+ac,function(d){27==d.which&&M()}),Y(P)):(ae.hide(),Y(af.onClose),af.loadUrl&&(af.contentContainer.empty(),ae.css({height:"auto",width:"auto"})))}function V(c){return c?W+Z.scrollLeft():W}function Q(c){return c?R+Z.scrollTop():R}function Y(c){a.isFunction(c)&&c.call(ae)}function b(){var c;N?c=af.position[1]:(c=((window.innerHeight||ad.height())-ae.outerHeight(!0))/2-af.amsl,c=c<f?f:c);R=c;W=T?af.position[0]:((window.innerWidth||ad.width())-ae.outerWidth(!0))/2;i=U()}function U(){return(window.innerHeight||ad.height())>ae.outerHeight(!0)+f&&(window.innerWidth||ad.width())>ae.outerWidth(!0)+f}a.isFunction(K)&&(P=K,K=null);var af=a.extend({},a.fn.bPopup.defaults,K);af.scrollBar||a("html").css("overflow","hidden");var ae=this,Z=a(document),ad=a(window),H=/OS 6(_\d)+/i.test(navigator.userAgent),f=20,X=0,ac,i,N,T,ab,R,W,o,aa,J;ae.close=function(){af=this.data("bPopup");ac="__b-popup"+ad.data("bPopup")+"__";M()};return ae.each(function(){if(!a(this).data("bPopup")){if(Y(af.onOpen),X=(ad.data("bPopup")||0)+1,ac="__b-popup"+X+"__",N="auto"!==af.position[1],T="auto"!==af.position[0],ab="fixed"===af.positionStyle,o=ae.outerHeight(!0),aa=ae.outerWidth(!0),af.loadUrl){switch(af.contentContainer=a(af.contentContainer||ae),af.content){case"iframe":var c=a('<iframe class="b-iframe" scrolling="no" frameborder="0"></iframe>');c.appendTo(af.contentContainer);o=ae.outerHeight(!0);aa=ae.outerWidth(!0);I();c.attr("src",af.loadUrl);Y(af.loadCallback);break;case"image":I();a("<img />").load(function(){Y(af.loadCallback);L(a(this))}).attr("src",af.loadUrl).hide().appendTo(af.contentContainer);break;default:I(),a('<div class="b-ajax-wrapper"></div>').load(af.loadUrl,af.loadData,function(){Y(af.loadCallback);L(a(this))}).hide().appendTo(af.contentContainer)}}else{I()}}})};a.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:0.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",zIndex:9997}})(jQuery);